(()=>{var e={162:function(e,t,n){var o,s,i;s=[],o=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function o(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){c(o.response,t,n)},o.onerror=function(){console.error("could not download file")},o.send()}function s(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,n){var r=a.URL||a.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?i(c):s(c.href)?o(e,t,n):i(c,c.target="_blank")):(c.href=r.createObjectURL(e),setTimeout((function(){r.revokeObjectURL(c.href)}),4e4),setTimeout((function(){i(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),n);else if(s(e))o(e,n,a);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){i(r)}))}}:function(e,t,n,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof e)return o(e,t,n);var i="application/octet-stream"===e.type,c=/constructor/i.test(a.HTMLElement)||a.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||i&&c||r)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=d?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=e:location=e,s=null},l.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,m=u.createObjectURL(e);s?s.location=m:location.href=m,s=null,setTimeout((function(){u.revokeObjectURL(m)}),4e4)}});a.saveAs=c.saveAs=c,e.exports=c},void 0===(i="function"==typeof o?o.apply(t,s):o)||(e.exports=i)},107:(e,t,n)=>{const{saveAs:o}=n(162),s="https://chaos-organizer-valerie-sidman.herokuapp.com",i=document.querySelector(".favorite-link");let a=JSON.parse(window.localStorage.getItem("favorite_msgs"));a||(a=[],window.localStorage.setItem("favorite_msgs",JSON.stringify(a)));const r=document.querySelector(".pin-block"),c=window.localStorage.getItem("pin-message");if(c){r.insertAdjacentHTML("afterbegin",c);r.querySelector(".unpin").addEventListener("click",(()=>{r.innerHTML="",window.localStorage.setItem("pin-message","")}))}const d=document.querySelector(".messages-block");let l="",u=1,m=[];function g(){let e,t;m.forEach((n=>{const s=new Date(n.date),i=s.getFullYear(),c=`0${s.getMonth()+1}`,l=`0${s.getDate()}`,u=`0${s.getHours()}`,m=`0${s.getMinutes()}`,g=`0${s.getSeconds()}`,p=`${l.substr(-2)}.${c.substr(-2)}.${i} ${u.substr(-2)}:${m.substr(-2)}:${g.substr(-2)}`;if("user"===n.type){t=document.createElement("div"),t.classList.add("message","user-msg"),t.setAttribute("id",`${n.id}`);let{text:o}=n.body;const s=o.split(" ");for(let e=0;e<s.length;e+=1)(s[e].startsWith("http://")||s[e].startsWith("https://"))&&(s[e]=`<a class="users-link" href="${s[e]}">${s[e]}</a>`);o=s.join(" "),e=` \n        <div class="user-msg-body">\n          <p class="user-msg-text">${o}</p>\n          ${n.body.fileName?`<div class="user-msg-file"><span class="material-icons attach-icon attach-msg-file">attach_file</span>\n          ${n.body.fileName}</div>`:""}\n        </div>\n        ${n.body.geolocation.latitude&&n.body.geolocation.longitude?`<span class="user-msg-geolocation">${n.body.geolocation.latitude}, ${n.body.geolocation.longitude}</span>`:""}\n      `}else"bot"===n.type&&"book"===n.body.type?(t=document.createElement("div"),t.classList.add("message","bot-msg","msg-book"),t.setAttribute("id",`${n.id}`),e=`\n        <div class="bot-msg-box">\n          <span class="book-intro">Рекомендую почитать:</span>\n          <p class="bot-msg-body">\n            Название: ${n.body.title}. \n            Автор: ${n.body.author}. \n            Жанр: ${n.body.genre}.\n          </p>\n        </div>\n      `):"bot"===n.type&&"forecast"===n.body.type?(t=document.createElement("div"),t.classList.add("message","bot-msg","msg-weather"),t.setAttribute("id",`${n.id}`),e=`\n        <div class="bot-msg-box">\n          <span class="weather-intro">Погода на сегодня:</span>\n          <p class="bot-msg-body">${n.body.temperature}, ${n.body.description}</p>\n        </div>\n      `):"bot"===n.type&&"game"===n.body.type?(t=document.createElement("div"),t.classList.add("message","bot-msg","msg-games"),t.setAttribute("id",`${n.id}`),e=`\n        <div class="bot-msg-box">\n          <span class="games-intro">Рекомендую поиграть:</span>\n          <p class="bot-msg-body">\n            Название: ${n.body.title}, \n            Жанр: ${n.body.genre},\n            Описание: ${n.body.description}\n          </p>\n        </div>\n      `):"bot"===n.type&&"recipe"===n.body.type?(t=document.createElement("div"),t.classList.add("message","bot-msg","msg-recipes"),t.setAttribute("id",`${n.id}`),e=`\n        <div class="bot-msg-box">\n          <span class="recipes-intro">Рекомендую приготовить:</span>\n          <p class="bot-msg-body">\n            ${n.body.title}, \n            Способ приготовления: ${n.body.cooking}\n          </p>\n        </div>\n      `):"bot"===n.type&&"serie"===n.body.type?(t=document.createElement("div"),t.classList.add("message","bot-msg","msg-series"),t.setAttribute("id",`${n.id}`),e=`\n        <div class="bot-msg-box">\n          <span class="series-intro">Рекомендую посмотреть:</span>\n          <p class="bot-msg-body">\n            Название: ${n.body.title}, \n            Жанр: ${n.body.genre},\n            Описание: ${n.body.description}\n          </p>\n        </div>\n      `):(console.error("Something wrong"),console.log(n),console.log("type: ",n.type,"body.type: ",n.body.type));a=JSON.parse(window.localStorage.getItem("favorite_msgs"));const f=`\n      <ul class="msg-tools">\n        <li class="msg-tool">\n          <button class="material-icons favorite-tool">${a&&a.find((e=>e.includes(`id="${n.id}"`)))?"favorite":"favorite_border"}</button>\n        </li>\n        <li class="msg-tool">\n          <button class="material-icons pin-tool">push_pin</button>\n        </li>\n      </ul>\n      ${e}\n      <div class="msg-info-panel">\n        <div class="msg-info-item">\n          <span class="msg-date">${p}</span>\n        </div>\n      </div>`;t.insertAdjacentHTML("beforeend",f);const v=(e,t)=>{const n=((e,t)=>{const n=e.split(","),o=n[0].match(/:(.*?);/)[1],s=atob(n[1]);let i=s.length;const a=new Uint8Array(i);for(;i>=0;i-=1)a[i]=s.charCodeAt(i);return new File([a],t,{type:o})})(e,t);o(n,t)},y=t.querySelector(".user-msg-file");y&&y.addEventListener("click",(()=>{v(n.body.file,n.body.fileName)}));const b=t.querySelector(".favorite-tool");b.addEventListener("click",(()=>{if("favorite_border"===b.textContent)b.textContent="favorite",a.push(b.closest(".message").outerHTML);else if("favorite"===b.textContent){b.textContent="favorite_border";const e=b.closest(".message").getAttribute("id"),t=a.findIndex((t=>t.includes(`id="${e}"`)));a.splice(t,1)}window.localStorage.setItem("favorite_msgs",JSON.stringify(a))})),d.appendChild(t);const L=t.querySelector(".pin-tool"),h=L.closest(".message");L.addEventListener("click",(()=>{if(0!==r.children.length)alert("You already have a pinned post. Only one message can be pinned.");else{h.classList.add("pin-msg"),r.insertAdjacentHTML("afterbegin",h.outerHTML);const e=document.querySelector(".pin-msg"),t=e.querySelector(".pin-tool");t.textContent="close",t.classList.remove("pin-tool"),t.classList.add("unpin"),window.localStorage.setItem("pin-message",e.outerHTML);e.querySelector(".unpin").addEventListener("click",(()=>{r.innerHTML=""}))}}))}))}function p(e){return new Promise((t=>{const n=new XMLHttpRequest,o=`${s}/api/messages?page=${u}`;let i=e;n.open("GET",o,!0),n.addEventListener("load",(()=>{if(200===n.status){const e=JSON.parse(n.response);if(e.length>0){d.innerHTML="",m=e.concat(m),g(),i<0&&(i=m[m.length-1].id);document.getElementById(i).scrollIntoView()}else u-=1;t()}})),n.send()}))}document.querySelector(".messages-block").addEventListener("scroll",(e=>{if(0===e.target.scrollTop){u+=1;p(m[0].id)}}),!1),p(-1);const f=document.querySelector(".typing-field"),v=document.querySelector(".send-icon"),y=document.querySelector(".loader"),b=document.querySelector(".file-name-text"),L=document.querySelector(".close-file"),h=document.querySelector(".file");let w="",E="";function S(){if(""!==f.value||""!==l||""!==w||""!==E){const e=new XMLHttpRequest,t=`${s}/api/messages/new`,n={};n.text=f.value,n.file=l,n.fileName=b.textContent,n.latitude=w,n.longitude=E,l="",w="",E="";const o=JSON.stringify(n);e.open("POST",t,!0),e.setRequestHeader("Content-type","application/json; charset=utf-8"),e.addEventListener("readystatechange",(()=>{4===e.readyState&&200===e.status&&(u=1,m=[],p(-1),f.value="",b.textContent="",L.classList.add("inactive"),v.classList.add("send-inactive"))})),e.send(o)}}function $(e){const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{l=t.result,y.classList.add("inactive"),v.classList.remove("send-inactive")}}function q(){""!==b.textContent&&y.classList.remove("inactive"),L.classList.remove("inactive"),L.addEventListener("click",(e=>{e.preventDefault(),b.innerHTML="",L.classList.add("inactive"),y.classList.add("inactive"),""===f.value&&v.classList.add("send-inactive")}))}h.addEventListener("change",(()=>{$(h.files[0]),b.innerHTML=h.files[0].name,q()})),f.addEventListener("input",(()=>{""!==f.value?v.classList.remove("send-inactive"):v.classList.add("send-inactive")}));document.querySelectorAll(".bot-command").forEach((e=>{e.addEventListener("click",(()=>{v.classList.remove("send-inactive"),""!==f.value?f.value+=` ${e.textContent}`:f.value+=e.textContent}))})),window.addEventListener("keypress",(function(e){"Enter"===e.key&&S()}),!1),v.addEventListener("click",S,!1);const k=document.querySelector(".drop-area");function x(e){e.preventDefault(),e.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach((e=>{k.addEventListener(e,x,!1),document.body.addEventListener(e,x,!1)})),k.addEventListener("drop",(function(e){const t=e.dataTransfer,{files:n}=t;!function(e){$(e[0]),b.innerHTML=e[0].name,q()}(n)}),!1);document.querySelector(".location-icon").addEventListener("click",(()=>{navigator.geolocation.getCurrentPosition((e=>{w=e.coords.latitude,E=e.coords.longitude,alert("Your geolocation has been successfully received!")}))}));const T=document.querySelector(".favorites_modal");document.querySelector(".modal_content").querySelector(".clear-favorite_msgs").addEventListener("click",(()=>{a=[],window.localStorage.setItem("favorite_msgs",JSON.stringify(a)),window.location.reload()})),i.addEventListener("click",(e=>{e.preventDefault(),T.classList.remove("inactive");const t=document.querySelector(".favorite_msgs");t.innerHTML="",a=JSON.parse(window.localStorage.getItem("favorite_msgs")),a.forEach((e=>{const n=document.createElement("li");n.innerHTML=e,t.appendChild(n)}))}));document.querySelector(".close_modal_btn").addEventListener("click",(()=>{T.classList.add("inactive")}));const M=document.querySelector(".search-field"),A=document.querySelector(".finded-counter"),H=document.querySelector(".finded-clear"),O=document.querySelector(".finded-left"),_=document.querySelector(".finded-right");let j,I,R=[];function C(){A.textContent=0;document.querySelectorAll(".finded-msg").forEach((e=>{e.classList.remove("finded-msg")})),I&&I.classList.contains("current-finded-msg")&&I.classList.remove("current-finded-msg")}function N(e,t){const n=m[0].id;e<n?(u+=1,p(-1).then((()=>{N(e,t)}))):t()}function B(e){const t=new XMLHttpRequest,n=`${s}/api/messages/find?query=${e}`;t.open("GET",n,!0),t.addEventListener("load",(()=>{if(200===t.status){const e=JSON.parse(t.response);e.length>0?(R=e,R.forEach((e=>{new Promise((t=>{N(e.id,t)})).then((()=>{document.getElementById(e.id).classList.add("finded-msg"),A.textContent=R.length,j=R.length-1,I=document.getElementById(R[j].id),I.classList.add("current-finded-msg"),I.scrollIntoView({behavior:"smooth"}),M.value=""}))}))):(alert("No results found for this search."),M.value="")}})),t.send()}O.addEventListener("click",(()=>{R.length>1&&(I.classList.remove("current-finded-msg"),j-=1,I=document.getElementById(R[j].id),I.classList.add("current-finded-msg"),I.scrollIntoView({behavior:"smooth"}))})),_.addEventListener("click",(()=>{R.length>1&&(I.classList.remove("current-finded-msg"),j+=1,I=document.getElementById(R[j].id),I.classList.add("current-finded-msg"),I.scrollIntoView({behavior:"smooth"}))})),H.addEventListener("click",(()=>{C()})),M.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),""!==M.value?(C(),B(M.value)):alert("Enter your request."))}))}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(107)})()})();